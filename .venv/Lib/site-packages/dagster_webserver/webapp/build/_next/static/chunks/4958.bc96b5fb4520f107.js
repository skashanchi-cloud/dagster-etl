(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4958],{54958:(e,t,n)=>{"use strict";n.r(t),n.d(t,{MergedAutomationRoot:()=>tn,default:()=>ts});var s=n(99649),r=n(93096),o=n(6029),i=n(83150),a=n(53451),l=n(33658),c=n(3066),d=n(33762),u=n(83007),h=n(43697),p=n(40264),m=n(55729),x=n(17970),j=n(9754),g=n(83655),v=n(44557),f=n(91232),S=n(41499),y=n(85347),w=n(11478);let k={step:"initial",completion:{completed:0,errors:{}}},T=(e,t)=>{switch(t.type){case"reset":return k;case"start":return(0,r._)((0,s._)({},e),{step:"updating"});case"update-success":{let{completion:t}=e;return{step:"updating",completion:(0,r._)((0,s._)({},t),{completed:t.completed+1})}}case"update-error":{let{completion:n}=e;return{step:"updating",completion:(0,r._)((0,s._)({},n),{completed:n.completed+1,errors:(0,r._)((0,s._)({},n.errors),{[t.name]:t.error})})}}case"complete":return(0,r._)((0,s._)({},e),{step:"completed"})}},b=()=>(0,m.useReducer)(T,k);var N=n(57639),A=n(46599),I=n(61479);let E=e=>{let{openWithIntent:t,onClose:n,automations:i}=e,a=i.length,[l,c]=b();(0,m.useEffect)(()=>{"not-open"===t&&c({type:"reset"})},[t,c]);let[h]=(0,y.n_)(I.kX),[p]=(0,y.n_)(I.qz),[x]=(0,y.n_)(A.DB),[j]=(0,y.n_)(A.Ds),k=async e=>{let{repoAddress:t,name:n,type:o}=e,i={repositoryLocationName:t.location,repositoryName:t.name};switch(o){case"sensor":{let{data:e}=await h({variables:{sensorSelector:(0,r._)((0,s._)({},i),{sensorName:n})}});switch(null==e?void 0:e.startSensor.__typename){case"Sensor":c({type:"update-success"});return;case"SensorNotFoundError":case"UnauthorizedError":case"PythonError":c({type:"update-error",name:n,error:e.startSensor.message})}break}case"schedule":{let{data:e}=await x({variables:{scheduleSelector:(0,r._)((0,s._)({},i),{scheduleName:n})}});switch(null==e?void 0:e.startSchedule.__typename){case"ScheduleStateResult":c({type:"update-success"});return;case"UnauthorizedError":case"PythonError":c({type:"update-error",name:n,error:e.startSchedule.message})}break}default:(0,w.dr)(o)}},T=async e=>{let{name:t,type:n,instigationState:s}=e,r={id:s.id};switch(n){case"sensor":{let{data:e}=await p({variables:r});switch(null==e?void 0:e.stopSensor.__typename){case"StopSensorMutationResult":c({type:"update-success"});return;case"UnauthorizedError":case"PythonError":c({type:"update-error",name:t,error:e.stopSensor.message})}break}case"schedule":{let{data:e}=await j({variables:r});switch(null==e?void 0:e.stopRunningSchedule.__typename){case"ScheduleStateResult":c({type:"update-success"});return;case"UnauthorizedError":case"PythonError":c({type:"update-error",name:t,error:e.stopRunningSchedule.message})}break}default:(0,w.dr)(n)}},E=async()=>{if("not-open"!==t){for(let e of(c({type:"start"}),i))"start"===t?await k(e):await T(e);c({type:"complete"})}},_="updating"!==l.step;return(0,o.jsxs)(S.lG,{isOpen:"not-open"!==t,title:"start"===t?"Start automations":"Stop automations",canEscapeKeyClose:_,canOutsideClickClose:_,onClose:n,children:[(0,o.jsx)(S.R4,{children:(0,o.jsxs)(f.Y,{direction:"column",spacing:24,children:[(()=>{if("not-open"===t)return null;switch(l.step){case"initial":if("stop"===t)return(0,o.jsx)("div",{children:"".concat(1===a?"1 automation":"".concat(a," automations")," will be stopped. Do you want to continue?")});return(0,o.jsx)("div",{children:"".concat(1===a?"1 automation":"".concat(a," automations")," will be started. Do you want to continue?")});case"updating":case"completed":let e=a>0?l.completion.completed/a:1;return(0,o.jsxs)(f.Y,{direction:"column",spacing:8,children:[(0,o.jsx)(v.z,{intent:"primary",value:Math.max(.1,e),animate:e<1}),"updating"===l.step?(0,o.jsx)(N.M,{message:"Automations are being updated, please do not navigate away yet."}):null]});default:return null}})(),(()=>{if("not-open"===t||"initial"===l.step)return null;if("updating"===l.step)return(0,o.jsx)("div",{children:"Please do not close the window or navigate away while automations are being updated."});let e=l.completion.errors,n=Object.keys(e).length,s=l.completion.completed-n;return(0,o.jsxs)(f.Y,{direction:"column",spacing:8,children:[s?(0,o.jsxs)(f.Y,{direction:"row",spacing:8,alignItems:"flex-start",children:[(0,o.jsx)(d.In,{name:"check_circle",color:u.P$()}),(0,o.jsx)("div",{children:"start"===t?"Successfully started ".concat(1===s?"1 automation":"".concat(s," automations"),"."):"Successfully stopped ".concat(1===s?"1 automation":"".concat(s," automations"),".")})]}):null,n?(0,o.jsxs)(f.Y,{direction:"column",spacing:8,children:[(0,o.jsxs)(f.Y,{direction:"row",spacing:8,alignItems:"flex-start",children:[(0,o.jsx)(d.In,{name:"warning",color:u.Ym()}),(0,o.jsx)("div",{children:"start"===t?"Could not start ".concat(1===n?"1 automation":"".concat(n," automations"),":"):"Could not stop ".concat(1===n?"1 automation":"".concat(n," automations"),":")})]}),(0,o.jsx)("ul",{style:{margin:"8px 0"},children:Object.keys(e).map(t=>(0,o.jsx)("li",{children:(0,o.jsxs)(f.Y,{direction:"row",spacing:8,children:[(0,o.jsxs)("strong",{children:[t,":"]}),e[t]?(0,o.jsx)("div",{children:e[t]}):null]})},t))})]}):null]})})()]})}),(0,o.jsx)(S.Es,{children:(()=>{if("not-open"===t)return null;switch(l.step){case"initial":return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(g.$n,{onClick:n,children:"Cancel"}),(0,o.jsx)(g.$n,{intent:"primary",onClick:E,children:"start"===t?"Start ".concat(1===a?"1 automation":"".concat(a," automations")):"Stop ".concat(1===a?"1 automation":"".concat(a," automations"))})]});case"updating":return(0,o.jsx)(g.$n,{intent:"primary",disabled:!0,children:"start"===t?"Starting ".concat(1===a?"1 automation":"".concat(a," automations")):"Stopping ".concat(1===a?"1 automation":"".concat(a," automations"))});case"completed":return(0,o.jsx)(g.$n,{intent:"primary",onClick:n,children:"Done"})}})()})]})};var _=n(66822);let C=e=>{let t=!1,n=!1;for(let s of e){let{status:e}=s;if(e===_.WqK.RUNNING?n=!0:e===_.WqK.STOPPED&&(t=!0),n&&t)break}return{anyOff:t,anyOn:n}},$=e=>{let{automations:t}=e,n=t.length,[s,r]=(0,m.useState)("not-open"),{anyOff:i,anyOn:a}=(0,m.useMemo)(()=>C(t.map(e=>{let{instigationState:t}=e;return t})),[t]);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(x.AM,{content:(0,o.jsxs)(j.W1,{children:[(0,o.jsx)(j.Dr,{text:"Start ".concat(1===n?"1 automation":"".concat(n," automations")),disabled:!i,"aria-disabled":!i,icon:"toggle_on",onClick:()=>{r("start")}}),(0,o.jsx)(j.Dr,{text:"Stop ".concat(1===n?"1 automation":"".concat(n," automations")),disabled:!a,"aria-disabled":!a,icon:"toggle_off",onClick:()=>{r("stop")}})]}),placement:"bottom-end",children:(0,o.jsx)(g.$n,{disabled:!n,intent:"primary",rightIcon:(0,o.jsx)(d.In,{name:"expand_more"}),children:"Actions"})}),(0,o.jsx)(E,{openWithIntent:s,automations:t,onClose:()=>r("not-open")})]})};var O=n(92524),R=n(10598),U=n(21440),M=n(92424),L=n(59541),z=n(12930),P=n(62225),D=n(59239),F=n(53112),K=n(67544),q=n(51784),G=n(38584),W=n(96331),H=n(75110),Y=n(65421),B=n(71421),V=n(97549),Q=n(78612),X=n.n(Q);let Z=e=>{let{tick:t}=e,[n,s]=(0,m.useState)(!1);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(x.AM,{content:(()=>{if(!t)return(0,o.jsx)(i.a,{padding:{vertical:8,horizontal:12},children:(0,o.jsx)(c.HL,{children:"No ticks yet"})});let e=J[t.status],n=(0,o.jsx)(B.D,{timestamp:{unix:t.timestamp}});switch(t.status){case _.lsI.FAILURE:return(0,o.jsx)(ee,{icon:e,title:"Latest tick failed",timestamp:n,content:(0,o.jsx)("div",{children:t.error?(0,o.jsx)(W.v,{onClick:()=>s(!0),children:"Show error"}):"Unknown error"})});case _.lsI.SUCCESS:{let s=t.runIds.length;return(0,o.jsx)(ee,{icon:e,title:"Latest tick succeeded",timestamp:n,content:(0,o.jsx)("div",{children:1===s?"1 run requested":"".concat(V.Eg.format(s)," runs requested")})})}case _.lsI.STARTED:return(0,o.jsx)(ee,{icon:e,title:"Evaluating tick",timestamp:n});case _.lsI.SKIPPED:default:var r;return(0,o.jsx)(ee,{icon:e,title:"Latest tick skipped",timestamp:n,content:(0,o.jsx)(c.HL,{children:null!=(r=t.skipReason)?r:"No reason provided"})})}})(),placement:"top",interactionKind:"hover",children:(0,o.jsx)(D.r,{children:t?J[t.status]:(0,o.jsx)(d.In,{name:"missing",color:u.fR()})})}),(null==t?void 0:t.error)?(0,o.jsxs)(S.lG,{isOpen:n,title:"Error",style:{width:"80vw"},children:[(0,o.jsx)(S.R4,{children:(0,o.jsx)(Y.Bf,{error:t.error})}),(0,o.jsx)(S.Es,{topBorder:!0,children:(0,o.jsx)(g.$n,{intent:"primary",onClick:()=>{s(!1)},children:"Done"})})]}):null]})},J={[_.lsI.FAILURE]:(0,o.jsx)(d.In,{name:"warning",color:u.Ym()}),[_.lsI.SUCCESS]:(0,o.jsx)(d.In,{name:"done",color:u.P$()}),[_.lsI.STARTED]:(0,o.jsx)(H.y,{purpose:"body-text"}),[_.lsI.SKIPPED]:(0,o.jsx)(d.In,{name:"status",color:u.fR()})},ee=e=>{let{icon:t,title:n,timestamp:s,content:r}=e;return(0,o.jsxs)(i.a,{padding:12,className:X().hoverContent,children:[(0,o.jsxs)(i.a,{border:r?"bottom":void 0,padding:r?{bottom:12}:void 0,margin:r?{bottom:8}:void 0,flex:{direction:"row",alignItems:"center",gap:8,justifyContent:"space-between"},children:[(0,o.jsxs)(i.a,{flex:{direction:"row",alignItems:"center",gap:8},children:[t,(0,o.jsx)("div",{children:n})]}),(0,o.jsx)("div",{children:s})]}),r?(0,o.jsx)("div",{children:r}):null]})};var et=n(98394),en=n(60845),es=n(92242),er=n(26277),eo=n(41735);let ei=e=>{var t;let n=null==(t=Intl.DateTimeFormat(navigator.language,{timeZone:e,timeZoneName:"shortOffset"}).formatToParts(new Date).find(e=>"timeZoneName"===e.type))?void 0:t.value,s=null==n?void 0:n.replace("GMT","");if(!s)return 0;let[r="0",o="0"]=s.split(":"),i=parseInt(r,10),a=parseInt(o,10)/60*(i<0?-1:1);return i+a};var ea=n(60288),el=n(39857),ec=n(14538);let ed=e=>{let{cronSchedule:t,executionTimezone:n}=e,{withHumanTimezone:s,withExecutionTimezone:r}=eu(t,n),i=(0,o.jsx)(q.mi,{rows:[{key:"Cron value",value:(0,o.jsx)(c.MC,{children:t})},{key:"Your time",value:(0,o.jsx)("span",{children:s})}]});return(0,o.jsx)(eh,{children:(0,o.jsx)(p.m,{content:i,placement:"top",children:(0,o.jsx)(er.v,{icon:"schedule",children:r})})})},eu=(e,t)=>{let{timezone:[n]}=(0,m.useContext)(el.RF);if(!e)return{withHumanTimezone:null,withExecutionTimezone:null};let s=t||"UTC",r=(0,ea.d)(e,{longTimezoneName:s}),o="Automatic"===n?(0,ec.qi)():n,i=ei(o),a=ei(s);return{withHumanTimezone:(0,ea.d)(e,{longTimezoneName:o,tzOffset:i-a}),withExecutionTimezone:r}},eh=eo.Ay.div.withConfig({componentId:"sc-fb93eb66-0"})([".bp5-popover-target{max-width:100%;:focus{outline:none;}}"]);var ep=n(2302),em=n(2925),ex=n(90161),ej=n(9329),eg=n(11665);n(21870);var ev=n(25909),ef=n(88647),eS=n(5356),ey=n(54535),ew=n(89250),ek=n(83669);let eT=(e,t)=>{if(e===_.WqK.STOPPED&&0===t||e===_.WqK.RUNNING&&1===t)return null;let n=[];return e===_.WqK.RUNNING&&0===t?n.push("Schedule is set to be running, but either the scheduler is not configured or the scheduler is not running the schedule"):e===_.WqK.STOPPED&&t>0&&n.push("Schedule is set to be stopped, but the scheduler is still running the schedule"),t>0&&n.push("Duplicate cron job for schedule found."),(0,o.jsx)(x.AM,{interactionKind:"hover",popoverClassName:"bp5-popover-content-sizing",position:"right",content:(0,o.jsxs)(i.a,{flex:{direction:"column",gap:8},padding:12,children:[(0,o.jsx)("strong",{children:"There are errors with this schedule."}),(0,o.jsx)("div",{children:"Errors:"}),(0,o.jsx)("ul",{children:n.map((e,t)=>(0,o.jsx)("li",{children:e},t))})]}),children:(0,o.jsx)(er.v,{fill:!0,interactive:!0,intent:"danger",children:"Error"})})};var eb=n(9108),eN=n(19281);n(30225);var eA=n(41185);function eI(){let e=(0,ej._)(["\n  query SingleScheduleQuery($selector: ScheduleSelector!) {\n    scheduleOrError(scheduleSelector: $selector) {\n      ... on Schedule {\n        id\n        name\n        pipelineName\n        description\n        scheduleState {\n          id\n          runningCount\n          hasStartPermission\n          hasStopPermission\n          ticks(limit: 1) {\n            id\n            ...TickTagFragment\n          }\n          runs(limit: 1) {\n            id\n            ...RunTimeFragment\n          }\n          nextTick {\n            timestamp\n          }\n        }\n        partitionSet {\n          id\n          name\n        }\n        ...ScheduleSwitchFragment\n      }\n    }\n  }\n\n  ","\n  ","\n  ","\n"]);return eI=function(){return e},e}let eE="1.2fr 1fr 1fr 76px 148px 210px 92px",e_="60px ".concat(eE);(0,eo.Ay)(i.a).withConfig({componentId:"sc-750823c9-0"})(["display:grid;grid-template-columns:",";height:100%;"],e=>{let{$showCheckboxColumn:t}=e;return t?e_:eE});let eC=(0,y.J1)(eI(),ey.G0,ew.vw,ek.M),e$=(0,m.forwardRef)((e,t)=>{var n,r,a;let{index:l,name:h,repoAddress:j,checked:g,onToggleChecked:v}=e,f=(0,L.V)(100),S=(0,y.IT)(eC,{variables:{selector:{repositoryName:j.name,repositoryLocationName:j.location,scheduleName:h}},skip:!f,notifyOnNetworkStatusChange:!0}),w=(0,y.IT)(ep.k,{variables:{scheduleSelector:{repositoryName:j.name,repositoryLocationName:j.location,scheduleName:h}},skip:!f});(0,et.Bj)(S,et.eO),(0,et.Bj)(w,et.eO);let{data:k}=S,T=(0,m.useMemo)(()=>(null==k?void 0:k.scheduleOrError.__typename)!=="Schedule"?null:k.scheduleOrError,[k]),b=null==T?void 0:T.scheduleState.ticks[0],{withHumanTimezone:N,withExecutionTimezone:A}=eu(null!=(n=null==T?void 0:T.cronSchedule)?n:null,null!=(r=null==T?void 0:T.executionTimezone)?r:null);return(0,o.jsx)(K.c,{ref:t,index:l,href:(0,ev.HG)(j,"/schedules/".concat(h)),checked:g,onToggle:v,renderLink:e=>{var{href:t}=e,n=(0,M._)(e,["href"]);return(0,o.jsx)(G.N_,(0,s._)({to:t||"#"},n))},left:(0,o.jsxs)(i.a,{flex:{direction:"row",gap:8,alignItems:"flex-start"},children:[(0,o.jsx)("div",{children:(0,o.jsx)(d.In,{name:"schedule"})}),(0,o.jsxs)(i.a,{flex:{direction:"column",gap:4},children:[(0,o.jsxs)(i.a,{flex:{direction:"row",gap:12,alignItems:"center"},children:[(0,o.jsx)(i.a,{flex:{direction:"row",gap:8,alignItems:"center"},children:h}),(null==T?void 0:T.description)?(0,o.jsx)(p.m,{content:(0,o.jsx)("div",{style:{width:320},children:T.description}),placement:"top",children:(0,o.jsx)(d.In,{name:"info",color:u.XN()})}):null]}),N?(0,o.jsxs)(c.Ub,{children:["Scheduled"," ",(0,o.jsx)(p.m,{placement:"top",content:(0,o.jsx)(q.mi,{rows:[{key:"Cron value",value:(0,o.jsx)(c.dC,{children:null!=(a=null==T?void 0:T.cronSchedule)?a:""})},{key:"Your time",value:(0,o.jsx)("span",{children:N})}]}),children:(0,o.jsx)("span",{children:A})})]}):(0,o.jsx)(z.E,{$width:80,$height:16})]})]}),right:(()=>{var e;if(S.loading&&!S.data)return(0,o.jsx)(z.E,{$width:200,$height:24});let t=(null==T?void 0:T.scheduleState.runs)||[];return(0,o.jsx)(P.p,{controls:[{key:"latest-run",control:(null==(e=t[0])?void 0:e.startTime)?(0,o.jsx)(x.AM,{position:"top",interactionKind:"hover",content:(0,o.jsx)("div",{children:(0,o.jsx)(es._O,{run:t[0],name:h})}),hoverOpenDelay:100,children:(0,o.jsx)(D.r,{children:(0,o.jsxs)(i.a,{flex:{direction:"row",alignItems:"center",gap:8},children:[(0,o.jsx)(en.lQ,{status:t[0].status}),(0,o.jsx)(ex.w,{unixTimestamp:t[0].startTime,showTooltip:!1})]})})},t[0].id):null},{key:"tick",control:(0,o.jsx)(Z,{tick:null!=b?b:null})},{key:"switch",control:(0,o.jsx)(i.a,{flex:{direction:"column",justifyContent:"center"},padding:{left:8},children:T?(0,o.jsx)(em.G,{repoAddress:j,schedule:T},h):(0,o.jsx)(F.S,{disabled:!0,indeterminate:!0,checked:!1,format:"switch"},h)})}]})})()})});e$.displayName="ObserveAutomationScheduleRow";var eO=n(53474),eR=n(51350);n(94961);var eU=n(1410);function eM(){let e=(0,ej._)(["\n  query SingleSensorQuery($selector: SensorSelector!) {\n    sensorOrError(sensorSelector: $selector) {\n      ... on Sensor {\n        id\n        description\n        name\n        targets {\n          pipelineName\n        }\n        metadata {\n          assetKeys {\n            path\n          }\n        }\n        minIntervalSeconds\n        description\n        sensorState {\n          id\n          runningCount\n          hasStartPermission\n          hasStopPermission\n          ticks(limit: 1) {\n            id\n            ...TickTagFragment\n          }\n          runs(limit: 1) {\n            id\n            ...RunTimeFragment\n          }\n          nextTick {\n            timestamp\n          }\n        }\n        ...SensorSwitchFragment\n      }\n    }\n  }\n\n  ","\n  ","\n  ","\n"]);return eM=function(){return e},e}let eL="1.5fr 180px 1fr 76px 120px 148px 180px",ez="60px ".concat(eL);(0,eo.Ay)(i.a).withConfig({componentId:"sc-92b4a7c3-0"})(["display:grid;grid-template-columns:",";height:100%;"],e=>{let{$showCheckboxColumn:t}=e;return t?ez:eL});let eP={[_.$Up.ASSET]:{name:"Asset sensor",icon:"sensors",description:"Asset sensors instigate runs when a materialization occurs"},[_.$Up.AUTO_MATERIALIZE]:{name:"Automation condition sensor",icon:"automation_condition",description:"Automation condition sensors trigger runs based on conditions defined on assets or checks."},[_.$Up.AUTOMATION]:{name:"Automation condition sensor",icon:"automation_condition",description:"Automation condition sensors trigger runs based on conditions defined on assets or checks."},[_.$Up.FRESHNESS_POLICY]:{name:"Freshness policy sensor",icon:"sensors",description:"Freshness sensors check the freshness of assets on each tick, then perform an action in response to that status"},[_.$Up.MULTI_ASSET]:{name:"Multi-asset sensor",icon:"sensors",description:"Multi asset sensors trigger job executions based on multiple asset materialization event streams"},[_.$Up.RUN_STATUS]:{name:"Run status sensor",icon:"sensors",description:"Run status sensors react to run status"},[_.$Up.STANDARD]:{name:"Standard sensor",icon:"sensors",description:null},[_.$Up.UNKNOWN]:{name:"Standard sensor",icon:"sensors",description:null}},eD=(0,y.J1)(eM(),ey.G0,ew.vw,eU.T),eF=(0,m.forwardRef)((e,t)=>{let{index:n,name:r,repoAddress:a,checked:l,onToggleChecked:h}=e,j=(0,L.V)(100),g=(0,y.IT)(eD,{variables:{selector:{repositoryName:a.name,repositoryLocationName:a.location,sensorName:r}},skip:!j}),v=(0,y.IT)(eO.X,{variables:{sensorSelector:{repositoryName:a.name,repositoryLocationName:a.location,sensorName:r}},skip:!j});(0,et.Bj)(g,et.eO),(0,et.Bj)(v,et.eO);let{data:f}=g,S=(0,m.useMemo)(()=>(null==f?void 0:f.sensorOrError.__typename)!=="Sensor"?null:f.sensorOrError,[f]),w=null==S?void 0:S.sensorState.ticks[0],k=null==S?void 0:S.sensorType,T=k?eP[k]:null;return(0,o.jsx)(K.c,{ref:t,index:n,href:(0,ev.HG)(a,"/sensors/".concat(r)),checked:l,onToggle:h,renderLink:e=>{var{href:t}=e,n=(0,M._)(e,["href"]);return(0,o.jsx)(G.N_,(0,s._)({to:t||"#"},n))},left:(0,o.jsxs)(i.a,{flex:{direction:"row",gap:8,alignItems:"flex-start"},children:[(0,o.jsx)("div",{children:(0,o.jsx)(d.In,{name:"sensors"})}),(0,o.jsxs)(i.a,{flex:{direction:"column",gap:4},children:[(0,o.jsxs)(i.a,{flex:{direction:"row",gap:12,alignItems:"center"},children:[r,(null==T?void 0:T.description)?(0,o.jsx)(p.m,{content:(0,o.jsx)("div",{style:{width:320},children:T.description}),placement:"top",children:(0,o.jsx)(d.In,{name:"info",color:u.XN()})}):null]}),(0,o.jsx)(c.Ub,{children:(null==S?void 0:S.sensorType)?eK[S.sensorType]:(0,o.jsx)(z.E,{$width:80,$height:16})})]})]}),right:(()=>{var e;if(g.loading&&!g.data)return(0,o.jsx)(z.E,{$width:200,$height:24});let t=(null==S?void 0:S.sensorState.runs)||[];return(0,o.jsx)(P.p,{controls:[{key:"latest-run",control:(null==(e=t[0])?void 0:e.startTime)?(0,o.jsx)(x.AM,{position:"top",interactionKind:"hover",content:(0,o.jsx)("div",{children:(0,o.jsx)(es._O,{run:t[0],name:r})}),hoverOpenDelay:100,children:(0,o.jsx)(D.r,{children:(0,o.jsxs)(i.a,{flex:{direction:"row",alignItems:"center",gap:8},children:[(0,o.jsx)(en.lQ,{status:t[0].status}),(0,o.jsx)(ex.w,{unixTimestamp:t[0].startTime,showTooltip:!1})]})})},t[0].id):null},{key:"tick",control:(0,o.jsx)(Z,{tick:null!=w?w:null})},{key:"switch",control:(0,o.jsx)(i.a,{flex:{direction:"column",justifyContent:"center"},padding:{left:8},children:S?(0,o.jsx)(eR.z,{repoAddress:a,sensor:S},r):(0,o.jsx)(F.S,{disabled:!0,indeterminate:!0,checked:!1,format:"switch"},r)})}]})})()})});eF.displayName="ObserveAutomationSensorRow";let eK={[_.$Up.ASSET]:"Asset sensor",[_.$Up.AUTOMATION]:"Automation condition sensor",[_.$Up.AUTO_MATERIALIZE]:"Automation condition sensor",[_.$Up.FRESHNESS_POLICY]:"Freshness policy sensor",[_.$Up.MULTI_ASSET]:"Multi-asset sensor",[_.$Up.RUN_STATUS]:"Run status sensor",[_.$Up.STANDARD]:"Standard sensor",[_.$Up.UNKNOWN]:"Unknown sensor type"},eq="60px minmax(400px, 1.5fr) 240px 1fr 200px 200px",eG=e=>{let{checkbox:t}=e;return(0,o.jsxs)(eA.Sy,{templateColumns:eq,sticky:!0,children:[(0,o.jsx)(eA.A3,{children:(0,o.jsx)("div",{style:{position:"relative",top:"-1px"},children:t})}),(0,o.jsx)(eA.A3,{children:"Name"}),(0,o.jsx)(eA.A3,{children:"Type"}),(0,o.jsx)(eA.A3,{children:"Target"}),(0,o.jsx)(eA.A3,{children:"Last tick"}),(0,o.jsx)(eA.A3,{children:"Last run"})]})},eW=(0,eo.Ay)(i.a).withConfig({componentId:"sc-40d0a0cf-0"})(["display:grid;grid-template-columns:",";height:100%;"],eq);var eH=n(42932);let eY=(0,m.forwardRef)((e,t)=>{var n;let{index:s,name:r,repoAddress:a,checked:l,onToggleChecked:d}=e,u=(0,L.V)(100),h=(0,y.IT)(eC,{variables:{selector:{repositoryName:a.name,repositoryLocationName:a.location,scheduleName:r}},skip:!u,notifyOnNetworkStatusChange:!0}),x=(0,y.IT)(ep.k,{variables:{scheduleSelector:{repositoryName:a.name,repositoryLocationName:a.location,scheduleName:r}},skip:!u});(0,et.Bj)(h,et.eO),(0,et.Bj)(x,et.eO);let{data:j}=h,g=(0,m.useMemo)(()=>(null==j?void 0:j.scheduleOrError.__typename)!=="Schedule"?null:j.scheduleOrError,[j]),v=null==g?void 0:g.scheduleState,f=(0,m.useMemo)(()=>{if(!v)return{disabled:!0};let{hasStartPermission:e,hasStopPermission:t,status:n}=v;return n!==_.WqK.RUNNING||t?n!==_.WqK.STOPPED||e?{disabled:!1}:{disabled:!0,message:"You do not have permission to start this schedule"}:{disabled:!0,message:"You do not have permission to stop this schedule"}},[v]),S=null==g?void 0:g.scheduleState.ticks[0],w=(null==g?void 0:g.pipelineName)?[{pipelineName:g.pipelineName}]:null,k=(null==(n=x.data)?void 0:n.scheduleOrError.__typename)==="Schedule"?x.data.scheduleOrError.assetSelection:null;return(0,o.jsx)("div",{ref:t,"data-index":s,children:(0,o.jsxs)(eW,{border:"bottom",children:[(0,o.jsx)(eA.$4,{children:(0,o.jsx)(p.m,{canShow:f.disabled,content:f.message||"",placement:"top",children:(0,o.jsx)(F.S,{disabled:f.disabled,checked:l,onChange:e=>{if(d&&e.target instanceof HTMLInputElement){let{checked:t}=e.target;d({checked:t,shiftKey:e.nativeEvent instanceof MouseEvent&&e.nativeEvent.getModifierState("Shift")})}}})})}),(0,o.jsx)(eA.$4,{children:(0,o.jsx)(i.a,{flex:{direction:"row",gap:8,alignItems:"flex-start",justifyContent:"space-between"},children:(0,o.jsxs)(i.a,{flex:{grow:1,gap:8},children:[g?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(em.G,{repoAddress:a,schedule:g},r),eT(g.scheduleState.status,g.scheduleState.runningCount)]}):(0,o.jsx)("div",{style:{width:30}}),(0,o.jsx)(G.N_,{to:(0,ev.HG)(a,"/schedules/".concat(r)),children:(0,o.jsx)(eH.A,{text:r})})]})})}),(0,o.jsx)(eA.$4,{children:g?(0,o.jsxs)(i.a,{flex:{direction:"column",gap:4},children:[(0,o.jsx)(ed,{cronSchedule:g.cronSchedule,executionTimezone:g.executionTimezone}),g.scheduleState.nextTick&&g.scheduleState.status===_.WqK.RUNNING?(0,o.jsx)(c.HL,{children:(0,o.jsxs)("div",{style:{overflow:"hidden",whiteSpace:"nowrap",maxWidth:"100%",textOverflow:"ellipsis"},children:["Next tick:\xa0",(0,o.jsx)(eb.J,{timestamp:g.scheduleState.nextTick.timestamp,timezone:g.executionTimezone,timeFormat:{showSeconds:!1,showTimezone:!0}})]})}):null]}):(0,o.jsx)(eg.ov,{queryResult:h})}),(0,o.jsx)(eA.$4,{children:(0,o.jsx)("div",{children:(0,o.jsx)(ef.r,{repoAddress:a,automationType:"schedule",targets:w,assetSelection:k})})}),(0,o.jsx)(eA.$4,{children:S?(0,o.jsx)("div",{children:(0,o.jsx)(eN.O,{tick:S,tickResultType:"runs"})}):(0,o.jsx)(eg.ov,{queryResult:h})}),(0,o.jsx)(eA.$4,{children:(null==g?void 0:g.scheduleState)&&(null==g?void 0:g.scheduleState.runs[0])?(0,o.jsx)(eS.A,{run:g.scheduleState.runs[0],name:r,showButton:!1,showHover:!0,showSummary:!1}):(0,o.jsx)(eg.ov,{queryResult:h})})]})})}),eB=(0,m.forwardRef)((e,t)=>{var n;let{index:s,name:r,repoAddress:a,checked:l,onToggleChecked:c}=e,d=(0,L.V)(100),u=(0,y.IT)(eD,{variables:{selector:{repositoryName:a.name,repositoryLocationName:a.location,sensorName:r}},skip:!d}),h=(0,y.IT)(eO.X,{variables:{sensorSelector:{repositoryName:a.name,repositoryLocationName:a.location,sensorName:r}},skip:!d});(0,et.Bj)(u,et.eO),(0,et.Bj)(h,et.eO);let{data:x}=u,j=(0,m.useMemo)(()=>(null==x?void 0:x.sensorOrError.__typename)!=="Sensor"?null:x.sensorOrError,[x]),g=null==j?void 0:j.sensorState,v=(0,m.useMemo)(()=>{if(!g)return{disabled:!0};let{hasStartPermission:e,hasStopPermission:t,status:n}=g;return n!==_.WqK.RUNNING||t?n!==_.WqK.STOPPED||e?{disabled:!1}:{disabled:!0,message:"You do not have permission to start this sensor"}:{disabled:!0,message:"You do not have permission to stop this sensor"}},[g]),f=null==j?void 0:j.sensorState.ticks[0],S=null==j?void 0:j.sensorType,w=S?eP[S]:null,k=(null==(n=h.data)?void 0:n.sensorOrError.__typename)==="Sensor"?h.data.sensorOrError.assetSelection:null;return(0,o.jsx)("div",{ref:t,"data-index":s,children:(0,o.jsxs)(eW,{border:"bottom",children:[(0,o.jsx)(eA.$4,{children:(0,o.jsx)(p.m,{canShow:v.disabled,content:v.message||"",placement:"top",children:(0,o.jsx)(F.S,{disabled:v.disabled,checked:l,onChange:e=>{if(c&&e.target instanceof HTMLInputElement){let{checked:t}=e.target;c({checked:t,shiftKey:e.nativeEvent instanceof MouseEvent&&e.nativeEvent.getModifierState("Shift")})}}})})}),(0,o.jsx)(eA.$4,{children:(0,o.jsx)(i.a,{flex:{direction:"row",gap:8,alignItems:"flex-start",justifyContent:"space-between"},children:(0,o.jsxs)(i.a,{flex:{grow:1,gap:8},children:[j?(0,o.jsx)(eR.z,{repoAddress:a,sensor:j},r):(0,o.jsx)("div",{style:{width:30}}),(0,o.jsx)(G.N_,{to:(0,ev.HG)(a,"/sensors/".concat(r)),children:(0,o.jsx)(eH.A,{text:r})})]})})}),(0,o.jsx)(eA.$4,{children:(0,o.jsx)("div",{children:w?w.description?(0,o.jsx)(p.m,{content:(0,o.jsx)("div",{style:{maxWidth:"300px"},children:w.description}),placement:"top",children:(0,o.jsx)(er.v,{icon:w.icon,children:w.name})}):(0,o.jsx)(er.v,{icon:w.icon,children:w.name}):null})}),(0,o.jsx)(eA.$4,{children:j?(0,o.jsx)("div",{children:(0,o.jsx)(ef.r,{targets:j.targets||null,repoAddress:a,assetSelection:k,automationType:j.sensorType})}):(0,o.jsx)(eg.ov,{queryResult:h})}),(0,o.jsx)(eA.$4,{children:f?(0,o.jsx)("div",{children:(0,o.jsx)(eN.O,{tick:f,tickResultType:"runs"})}):(0,o.jsx)(eg.ov,{queryResult:u})}),(0,o.jsx)(eA.$4,{children:(null==j?void 0:j.sensorState)&&(null==j?void 0:j.sensorState.runs[0])?(0,o.jsx)(eS.A,{run:j.sensorState.runs[0],name:r,showButton:!1,showHover:!0,showSummary:!1}):(0,o.jsx)(eg.ov,{queryResult:u})})]})})});var eV=n(15183),eQ=n(4984),eX=n(67402);let eZ=(e,t)=>"".concat((0,eX.FC)(e),"-").concat(t);var eJ=n(4104),e0=n(21983);let e1=e=>{let{repos:t,headerCheckbox:n,checkedKeys:s,onToggleCheckFactory:r}=e,{flagUseNewObserveUIs:i}=(0,eV.h)(),a=m.useRef(null),l=m.useMemo(()=>t.map(e=>{let{repoAddress:t}=e;return(0,eX.FC)(t)}),[t]),{expandedKeys:c,onToggle:d,onToggleAll:u}=(0,e0.A)(eQ.i,l),h=m.useMemo(()=>{let e=[];return t.forEach(t=>{let{repoAddress:n,schedules:s,sensors:r}=t;e.push({type:"header",repoAddress:n,scheduleCount:s.length,sensorCount:r.length});let o=(0,eX.FC)(n);if(c.includes(o)){let t=new Set(r),o=new Set(s);[...r,...s].sort((e,t)=>w.Vp.compare(e,t)).forEach(s=>{t.has(s)?e.push({type:"sensor",repoAddress:n,sensor:s}):o.has(s)&&e.push({type:"schedule",repoAddress:n,schedule:s})})}}),e},[t,c]),p=(0,eJ.F)(t.map(e=>{let{repoAddress:t}=e;return t.name})),x=(0,U.Te)({count:h.length,getScrollElement:()=>a.current,estimateSize:e=>{let t=h[e];return(null==t?void 0:t.type)==="header"?32:62},overscan:15}),j=x.getTotalSize(),g=x.getVirtualItems();return(0,o.jsx)("div",{style:{overflow:"hidden"},children:(0,o.jsxs)(eA.mc,{ref:a,children:[i?null:(0,o.jsx)(eG,{checkbox:n}),(0,o.jsx)(eA.Rp,{$totalHeight:j,children:g.map(e=>{let{index:t,key:n,size:a,start:l}=e,m=h[t],j=m.type;if("header"===j)return(0,o.jsx)(R.fI,{$height:a,$start:l,children:(0,o.jsx)(eg.ur,{repoAddress:m.repoAddress,ref:x.measureElement,index:t,onToggle:d,onToggleAll:u,expanded:c.includes((0,eX.FC)(m.repoAddress)),showLocation:p.has(m.repoAddress.name),rightElement:(0,o.jsx)(o.Fragment,{})})},n);if("sensor"===j){let e=eZ(m.repoAddress,m.sensor);return i?(0,o.jsx)(R.fI,{$height:a,$start:l,children:(0,o.jsx)(eF,{index:t,ref:x.measureElement,name:m.sensor,checked:s.has(e),onToggleChecked:r(e),repoAddress:m.repoAddress},n)},n):(0,o.jsx)(R.fI,{$height:a,$start:l,children:(0,o.jsx)(eB,{index:t,ref:x.measureElement,name:m.sensor,checked:s.has(e),onToggleChecked:r(e),repoAddress:m.repoAddress})},n)}if("schedule"===j){let e=eZ(m.repoAddress,m.schedule);return i?(0,o.jsx)(R.fI,{$height:a,$start:l,children:(0,o.jsx)(e$,{index:t,ref:x.measureElement,name:m.schedule,checked:s.has(e),onToggleChecked:r(e),repoAddress:m.repoAddress},n)},n):(0,o.jsx)(R.fI,{$height:a,$start:l,children:(0,o.jsx)(eY,{index:t,ref:x.measureElement,name:m.schedule,checked:s.has(e),onToggleChecked:r(e),repoAddress:m.repoAddress},n)},n)}return(0,o.jsx)("div",{},n)})})]})})};var e4=n(77426),e2=n(32857),e8=n(10293),e5=n(42461),e9=n(99480),e3=n(56808),e6=n(49593),e7=n(51839);let te=e=>e.hasStartPermission&&e.status===_.WqK.STOPPED||e.hasStopPermission&&e.status===_.WqK.RUNNING;var tt=n(18088);let tn=()=>{(0,e2.b7)(),(0,e3.r)("Automation");let e=(0,e8.I)(),{automations:t,repoBuckets:n,loading:x}=(0,e4.M)(),[j,g]=(0,e6.m)({queryKey:"selection",defaults:{selection:""},behavior:"push"}),v=(0,m.useMemo)(()=>(0,e5.N)(t,j),[t,j]),f=(0,m.useMemo)(()=>n.filter(e=>Array.from(v).some(t=>t.repo.name===e.repoAddress.name&&t.repo.location===e.repoAddress.location)).map(e=>(0,r._)((0,s._)({},e),{schedules:e.schedules.filter(e=>v.has(e)),sensors:e.sensors.filter(e=>v.has(e))})).filter(e=>!!e.schedules.length||!!e.sensors.length),[n,v]),S=(0,m.useMemo)(()=>f.map(e=>{let{repoAddress:t,schedules:n,sensors:s}=e;return[...s.filter(e=>{let{sensorState:t}=e;return te(t)}).map(e=>{let{name:n,sensorState:s}=e;return{repoAddress:t,name:n,type:"sensor",instigationState:s}}),...n.filter(e=>{let{scheduleState:t}=e;return te(t)}).map(e=>{let{name:n,scheduleState:s}=e;return{repoAddress:t,name:n,type:"schedule",instigationState:s}})]}).flat(),[f]),y=(0,m.useMemo)(()=>S.map(e=>{let{repoAddress:t,name:n}=e;return eZ(t,n)}),[S]),[{checkedIds:w},{onToggleFactory:k,onToggleAll:T}]=(0,e7._)(y),b=(0,m.useMemo)(()=>{let e=new Set(f.map(e=>{let{repoAddress:t,schedules:n,sensors:s}=e;return[...n,...s].map(e=>{let{name:n}=e;return eZ(t,n)})}).flat());return y.filter(t=>e.has(t))},[y,f]),N=(0,m.useMemo)(()=>{let e=new Set(b.filter(e=>w.has(e)));return S.filter(t=>{let{repoAddress:n,name:s}=t;return e.has(eZ(n,s))})},[b,S,w]),A=y.length>0,I=N.length,E=b.length>0,_=(0,m.useMemo)(()=>f.map(e=>({repoAddress:e.repoAddress,schedules:e.schedules.map(e=>e.name),sensors:e.sensors.map(e=>e.name)})),[f]);return(0,o.jsxs)(i.a,{flex:{direction:"column"},style:{height:"100%",overflow:"hidden"},children:[(0,o.jsx)(h.z,{title:(0,o.jsx)(c.M7,{children:"Automation"})}),"has-global-amp"===e?(0,o.jsx)(i.a,{padding:{horizontal:24},border:"bottom",children:(0,o.jsx)(O.M,{tab:"schedules-and-sensors"})}):null,(0,o.jsxs)(i.a,{padding:{horizontal:24,vertical:12},flex:{direction:"row",alignItems:"center",justifyContent:"space-between",gap:12,grow:0},children:[(0,o.jsx)(i.a,{flex:{grow:1},children:(0,o.jsx)(e9.G,{items:t,value:j,onChange:g})}),(0,o.jsx)(p.m,{content:"You do not have permission to start or stop these schedules",canShow:E&&!A,placement:"top-end",useDisabledButtonTooltipFix:!0,children:(0,o.jsx)($,{automations:N})})]}),x?(0,o.jsx)(i.a,{flex:{direction:"row",justifyContent:"center"},padding:{top:64},children:(0,o.jsx)(a.V,{label:"Loading automations…"})}):0===f.length?j?(0,o.jsx)(i.a,{padding:{top:20},children:(0,o.jsx)(l.I,{icon:"search",title:"No matching automations",description:(0,o.jsxs)("div",{children:["No automations matching ",(0,o.jsx)("strong",{children:j})," were found in your definitions"]})})}):(0,o.jsx)(i.a,{padding:{top:20},children:(0,o.jsx)(l.I,{icon:"search",title:"No automations",description:(0,o.jsxs)(c.jz,{children:["There are no automations in this deployment."," ",(0,o.jsx)("a",{href:"https://docs.dagster.io/concepts/automation",target:"_blank",rel:"noreferrer",children:(0,o.jsxs)(i.a,{flex:{direction:"row",gap:4,alignItems:"center"},children:["Learn more about automations",(0,o.jsx)(d.In,{name:"open_in_new",color:u.Hv()})]})})]})})}):(0,o.jsx)(e1,{headerCheckbox:A?(0,o.jsx)(tt.t,{checkedCount:I,totalCount:b.length,onToggleAll:T}):void 0,repos:_,checkedKeys:w,onToggleCheckFactory:k})]})},ts=tn},78612:e=>{e.exports={hoverContent:"LatestTickHoverButton_hoverContent__4QRVM"}},92524:(e,t,n)=>{"use strict";n.d(t,{M:()=>u});var s=n(6029),r=n(44263),o=n(83150),i=n(75110),a=n(83007),l=n(10293),c=n(20574),d=n(85725);let u=e=>{let{tab:t}=e,n=(0,c.Aw)(),u=(0,l.I)();return(0,s.jsxs)(r.tU,{selectedTabId:t,children:[(0,s.jsx)(d.s,{id:"schedules-and-sensors",title:"Schedules and sensors",to:"/automation"}),"has-global-amp"===u?(0,s.jsx)(d.s,{id:"global-amp",title:(0,s.jsxs)(o.a,{flex:{direction:"row",gap:8,alignItems:"center"},children:[(0,s.jsx)("div",{children:"Auto-materialize"}),n.loading?(0,s.jsx)(i.y,{purpose:"body-text"}):(0,s.jsx)("div",{style:{width:"10px",height:"10px",borderRadius:"50%",backgroundColor:!1===n.paused?a.iZ():a.fR()}})]}),to:"/overview/automation"}):null]})}}}]);
//# sourceMappingURL=4958.bc96b5fb4520f107.js.map